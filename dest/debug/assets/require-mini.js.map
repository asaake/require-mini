{"version":3,"file":null,"sources":["app/assets/javascripts/require.coffee","app/assets/javascripts/mocker.coffee","app/assets/javascripts/require-mini.coffee"],"names":[],"mappings":"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","sourcesContent":["class @Require\n\n  constructor: () ->\n    @defined = {}\n    @loaded = {}\n    @dependences = {}\n\n  createDef: (args) ->\n    def = {\n      name: null\n      deps: []\n      func: null\n    }\n    if Object.isString(args[0])\n      def.name = args[0]\n      if args.length == 2\n        def.func = args[1]\n      if args.length == 3\n        def.deps = args[1]\n        def.func = args[2]\n    else if Object.isArray(args[0])\n      def.deps = args[0]\n      def.func = args[1]\n    else if Object.isFunction(args[0])\n      def.func = args[0]\n\n    # validate\n    valid = true\n    valid = valid && (!(def.name?) || Object.isString(def.name))\n    valid = valid && (Object.isArray(def.deps))\n    valid = valid && (Object.isFunction(def.func))\n\n    if !valid\n      new Error(\"args is [name, func] or [name, deps, func], or [deps, func], or [func]\")\n\n    return def\n\n  define: () ->\n    def = @createDef(arguments)\n    if def.name? && @defined[def.name]?\n      throw new Error(\"define #{def.name} is duplicate. override define is $define function.\")\n    @$define.apply(@, arguments)\n    return\n\n  $define: () ->\n    def = @createDef(arguments)\n    @undefine(def.name) if @defined[def.name]?\n    @defined[def.name] = def\n\n    for dep in def.deps\n      @dependences[dep] ?= {}\n      @dependences[dep][def.name] = true\n\n    return\n\n  undefine: (name) ->\n    @unload(name)\n    define = @defined[name]\n    delete @defined[name]\n    for dep in define.deps\n      delete @dependences[dep][name]\n    return\n\n  unload: (name) ->\n    delete @loaded[name]\n    deps = @dependences[name]\n    if deps?\n      for dep of deps\n        delete @loaded[dep]\n    return\n\n  run: () ->\n    if arguments.length < 1 || arguments.length > 2\n      throw new Error(\"args is [func] or [deps, func]\")\n\n    def = @createDef(arguments)\n    args = []\n    for dep in def.deps\n      args.push(@load(dep, def))\n\n    return def.func.apply(null, args)\n\n  load: (name, parent=null) ->\n\n    return @ if name == \"require\"\n    return @loaded[name] if (@loaded[name])\n\n    define = @defined[name]\n    if not(define?)\n      msg = \"#{name} is not defined.\"\n      if (parent?)\n        msg += \"\\n  name to [\" + (parent.name) + \"]\"\n        msg += \"\\n  deps to [#{parent.deps.toString()}]\"\n        msg += \"\\n  source to #{parent.func.toString()}\"\n      throw new Error(msg)\n\n    args = []\n    for dep in define.deps\n      args.push(@load(dep, define))\n\n    @loaded[name] = define.func.apply(null, args)\n    return @loaded[name]\n\n  clone: () ->\n    require = new Require()\n    require.defined = Object.clone(@defined)\n    require.loaded = Object.clone(@loaded)\n    require.dependences = Object.clone(@dependences)\n    return require\n\nrequire = new @Require()\n\n@require = () ->\n  return require.run.apply(require, arguments)\n\n@require._ = require\n\n@define = () ->\n  require.define.apply(require, arguments)\n  return\n\n@$define = () ->\n  require.$define.apply(require, arguments)\n  return\n\n\n\n\n\n\n\n\n\n\n","define \"mocker\", [\n  \"require\"\n], (\n  require\n) ->\n\n  class Mocker\n\n    constructor: () ->\n      @require = require.clone()\n      @unload()\n\n    unload: () ->\n      for name of @require.loaded\n        @require.unload(name)\n\n    mock: () ->\n      @require.$define.apply(@require, arguments)\n\n    run: () ->\n      @require.run.apply(@require, arguments)\n      @unload()\n\n\n","#(=) require require\n#(=) require mocker\n"],"sourceRoot":"/"}